<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">
    <changeSet failOnError="false" author="Emeka" id="20220929-prep">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="prep_client"/>
            </not>
        </preConditions>
        <sql>
            CREATE TABLE prep_client
            (
                id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
                unique_client_id VARCHAR(255),
                date_enrolled date,
                population_type  VARCHAR(255),
                partner_type  VARCHAR(255),
                hiv_testing_point VARCHAR(255),
                date_of_last_hiv_negative_test date,
                date_referred_for_prep         date,
                person_uuid   VARCHAR(255),
                extra JSONB,
                facility_id BIGINT,
                uuid VARCHAR(255),
                created_by    VARCHAR(255) NOT NULL,
                date_created  TIMESTAMP WITHOUT TIME ZONE NOT NULL,
                modified_by   VARCHAR(255),
                date_modified TIMESTAMP WITHOUT TIME ZONE,
                archived INTEGER,
                CONSTRAINT unique_prep_uuid UNIQUE (uuid),
                CONSTRAINT pk_prep_client PRIMARY KEY (id),
                CONSTRAINT prep_person_uuid_fk FOREIGN KEY (person_uuid)
                    REFERENCES patient_person (uuid) MATCH SIMPLE
                    ON UPDATE NO ACTION
                    ON DELETE NO ACTION,
                CONSTRAINT population_type_fk FOREIGN KEY (population_type)
                    REFERENCES base_application_codeset (code) MATCH SIMPLE
                    ON UPDATE NO ACTION
                    ON DELETE NO ACTION,
                CONSTRAINT partner_type_fk FOREIGN KEY (partner_type)
                    REFERENCES base_application_codeset (code) MATCH SIMPLE
                    ON UPDATE NO ACTION
                    ON DELETE NO ACTION,
                CONSTRAINT hiv_testing_point_fk FOREIGN KEY (hiv_testing_point)
                    REFERENCES base_application_codeset (code) MATCH SIMPLE
                    ON UPDATE NO ACTION
                    ON DELETE NO ACTION
            )
        </sql>
    </changeSet>
</databaseChangeLog>